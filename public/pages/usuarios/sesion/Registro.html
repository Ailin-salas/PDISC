<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="../../../assets/css/registro.css">
    <script src="https://kit.fontawesome.com/58a0dc3146.js" crossorigin="anonymous"></script>
</head>
<body>
    <div class="background-container">
        <div class="registration-form">
            <h2>Registro</h2>
            <form id="registro-form">
                <div class="form-group">
                    <input type="text" id="nombre" name="username" placeholder="Usuario" required>
                </div>
                <div class="form-group">
                    <input type="email" id="email" name="email" placeholder="Email" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" name="password" placeholder="Contraseña" required>
                </div>
                <div class="form-group">
                    <input type="password" id="confirm-password" name="confirm-password" placeholder="Confirme su Contraseña" required>
                </div>
                <button type="submit" class="register-btn">Registrarse <i class="fa-solid fa-bolt"></i></button>
            </form>
            <div class="login-link">
                <p>¿Ya tienes una cuenta? <a href="../../usuario/inicio/login.html">Inicia Sesión <i class="fa-solid fa-arrow-right-to-bracket"></i></a></p><br>
                <button id="guest-login-btn">Acceder como Invitado</button>
            </div>
        </div>
    </div>
<script>
     function sanitizeInput(input) {
        // Convierte caracteres peligrosos en entidades HTML seguras
        return input.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
    }
    // Lógica para el formulario de registro
    const form = document.getElementById('registro-form');
    form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Sanitiza los valores de los campos antes de usarlos
        const nombre = sanitizeInput(document.getElementById('nombre').value);
        const email = sanitizeInput(document.getElementById('email').value);
        const password = sanitizeInput(document.getElementById('password').value);
        const confirmPassword = sanitizeInput(document.getElementById('confirm-password').value);

        if (password !== confirmPassword) {
            alert('Las contraseñas no coinciden.');
            return;
        }

        try {
            const response = await fetch('http://localhost:3000/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ nombre, email, password })
            });

            const result = await response.json();

            if (response.ok) {
                alert('¡Registro exitoso! Ya puedes iniciar sesión.');
                window.location.href = '../../usuario/inicio/login.html'; 
            } else {
                alert('Error en el registro: ' + result.error);
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Ocurrió un error al intentar registrarse.');
        }
    });

    // Lógica para el botón de acceso de invitado (separada del formulario)
    document.getElementById('guest-login-btn').addEventListener('click', async () => {
        try {
            const response = await fetch('http://localhost:3000/auth/guest-login', {
                method: 'POST',
            });

            const result = await response.json();

            if (response.ok) {
                alert('Acceso de invitado exitoso!');
                localStorage.setItem('token', result.token);
                window.location.href = '../../usuario/inicio/home.html';
            } else {
                alert('Error: ' + result.error || 'No se pudo iniciar sesión como invitado.');
            }
        } catch (error) {
            console.error('Error:', error);
            alert('Ocurrió un error al intentar el acceso de invitado.');
        }
    });
</script>
</body>
</html>